[General]
SyntaxVersion=2
BeginHotkey=113
BeginHotkeyMod=0
PauseHotkey=19
PauseHotkeyMod=0
StopHotkey=114
StopHotkeyMod=0
RunOnce=1
EnableWindow=
MacroID=44ac38df-5d0e-4ad5-a560-c3de8261163e
Description=版本升级自动派单
Enable=1
AutoRun=0
[Repeat]
Type=0
Number=1
[SetupUI]
Type=1
QUI=Form1
[Relative]
SetupOCXFile=
[Comment]

[UIPackage]
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


[Script]

fpath=Form1.BrowseBox1.Path
Call Plugin.Office.OpenXls(fpath)
//---------------标题-------------------
orderNum = int(Form1.ComboBox1.ListIndex) + 2
//TracePrint orderNum
title = Plugin.Office.ReadXls(1, orderNum, 2)
title="【C华为-集中操作-B级】关于" & title  &"基站单板软件版本与BSC配置不一致，需对相关基站涉及板件进行升级"
Call titleSet(title)
//---------------日期设置-------------------
Call dateSet
//---------------工单内容-------------------
btsNums = Plugin.Office.ReadXls(1, orderNum, 3)
TracePrint btsNums
content="客调部近期维护作业检查发现：C网华为基站单板软件版本与BSC配置不一致情况，涉及基站" & btsNums  & "个，现申请版本升级。操作过程中可能会引起板件复位，短暂影响业务2分钟左右，操作申请人：客服调度部维护操作公务，联系电话：020-38906167"
Call contentSet(content)
//----------------影响网元------------------
citys = Plugin.Office.ReadXls(1, orderNum, 4)
btsIds = Plugin.Office.ReadXls(1, 2, orderNum+4)
For row = 3 To 1000
    btsId = Plugin.Office.ReadXls(1, row, orderNum + 4)
    btsId2 = Plugin.Office.ReadXls(1, row+1, orderNum+4)
    If btsId <> "" Then
        btsIds = btsIds & "," & btsId
    ElseIf btsId = "" and btsId2 <> "" Then
        btsIds = btsIds & "-"
    ElseIf btsId = "" and btsId2 = "" Then 
        Exit For
    End if
Next
Call insertBts(citys, btsIDs)
//----------------上传附件------------------
attPath = Plugin.Office.ReadXls(1, orderNum, 5)
Call uploadAttachment(attPath)
//----------------设置处理、审核、传阅------------------
Call choosePersons(citys)

Call Plugin.Office.CloseXls()
//----------------------------------


Sub titleSet(title)
    Call cz(223, 171)//标题
    Call ctrlV(title)
End Sub

Sub dateSet
    Call cz(234,205) //申请类型
    Call cz(271,248) //维护操作
    Call cz(606,204) //要求最后审批时间
    Call cz(609,396) //点时
    Call cz(699,350) //17时
    Call cz(635,396) //点分
    Call cz(607, 375) //30分
    Call cz(725,418) //确定
    Call cz(1056, 203)//申请操作开始时间
    FindColor 965, 263,1141, 385,"E9E4A9",intX,intY
    If intX > 0 And intY > 0 Then 
        Call cz(intX+26,intY)
    End If
    Call cz(1004,398) //点时
    Call cz(1021,305) //1时
    Call cz(1028,396) //点分
    Call cz(1003,353) //0分
    Call cz(1118, 417)//确定
    Call cz(1398,203)//申请操作结束时间
    FindColor 1361, 264,1536, 383,"E9E4A9",intX,intY
    If intX > 0 And intY > 0 Then 
        Call cz(intX+26,intY)
    End If
    Call cz(1400,399) //点时
    Call cz(1470,307) //1时
    Call cz(1422,394) //点分
    Call cz(1399,352) //0分
    Call cz(1510, 417)//确定
End Sub

Sub contentSet(content)
    Call cz(503, 334)//工单内容
    Call ctrlV(content)
End Sub

Sub insertBts(citys, btsIds)
    arr = Split(citys, ",")
    brr = Split(btsIds, "-,")
    For i=0 to UBound(arr)
        Call cz2(213, 419)//增加（影响网元）
        Do 
            FindColorEx 462, 177,489, 200,"02881E",0,0.9,intX,intY
            If intX > 0 And intY > 0 Then 
                Call ctrlV(brr(i)) //输入网元编号
                Exit Do 
            End If
            Delay 100
        Loop
        Call cz2(1110, 157) //双击地市选中
        Select Case arr(i)
        Case "gz"
        Case "sz"
            KeyPress "Down", 1
        Case "dg"
            KeyPress "Down", 2
        Case "fs"
            KeyPress "Down", 3
        Case "zs"
            KeyPress "Down", 4
        Case "hz"
            KeyPress "Down", 5
        Case "zh"
            KeyPress "Down", 6
        Case "zj"
            KeyPress "Down", 9
        Case "mm"
            KeyPress "Down", 10
        Case "yj"
            KeyPress "PageDown", 1
            KeyPress "Up", 1
        End Select
        Call cz(377, 187)//查询
        Do
            IfColor 498,237,"FFDAAF",0 Then
                Call cz(560, 187)//全选提交
                Exit Do
            End If
            Delay 100
        Loop
        Delay 500
    Next    
End Sub

Sub uploadAttachment(path)
    Call cz(1319, 601)//添加
    Delay 500
    Call cz(600, 539)//浏览
    Delay 600
    Call ctrlV(path)
    Call cz(1031,705) //打开
    Call cz(750, 539)//上传
End Sub

Sub choosePerson(x,y,p,citys)
    Call cz(x,y)
    Do 
        FindColorEx 510, 176,540, 204,"61E271",0,0.9,intX,intY
        If intX > 0 And intY > 0 Then 
            Call cz(546,190) //添加
            Exit Do 
        End If
        Delay 100
    Loop
    
    Do
        IfColor 870,462,"FFDAAF",0 Then
            Call cz(565, 200)//搜索
            Exit Do
        End If
        Delay 100
    Loop

    Do 
        FindColor 604, 207,1017, 259,"8A561C",intX,intY
        If intX > 0 And intY > 0 Then 
            Call cz(1040, 223)//点击人员
            Exit Do 
        End If
        Delay 100
    Loop

    If p="clsh" Then 
        Call ctrlV("客服调度部维护操作公务")
        Call cz(542, 271)//查询
        Do
            IfColor 744,316,"FFDAAF",0 Then
                Call cz(514, 315)//勾选
                Exit Do
            End If
            Delay 100
        Loop        
    Else 
        arr = Split(citys, ",")
        For i = 0 To UBound(arr)
            Call cz(1040, 223)//点击人员
            If i <> 0 Then 
                KeyPress "End", 1
                For j=1 to 10
                    KeyPress "BackSpace", 1
                    Delay 50
                Next  
            End If
            Select Case arr(i)
            Case "gz"
                gw="广州无线中心公务"
            Case "sz"
                gw = "深圳无线中心公务"
            Case "dg"
                gw = "东莞中心监控公务"
            Case "fs"
                gw = "佛山无线中心公务"
            Case "zs"
                gw = "中山无线中心公务"
            Case "hz"
                gw = "惠州中心监控公务"
            Case "zh"
                Goto here
            Case "zj"
                gw = "湛江中心监控公务"
            Case "mm"
                gw = "茂名无线中心公务"
            Case "yj"
                gw = "阳江无线公务"
            End Select
            
            Call ctrlV(gw)
            Call cz(542, 271)//查询
            Do
                IfColor 744,316,"FFDAAF",0 Then
                    Call cz(514, 315)//勾选
                    Exit Do
                End If
                Delay 100
            Loop  
            Rem here
        Next  
    End If
    
    Call cz(877,721) //确定
    Call cz(780, 782)//确定
End Sub

Sub choosePersons(citys)
    Call choosePerson(245, 655,"clsh","")//点击处理人员
    Call choosePerson(212, 685,"clsh","")//点击审核人员
    Call choosePerson(205, 719,"qy",citys)//点击传阅人员
End Sub
//Call cz()
//Call ctrlV()
Sub cz(x,y)	
    MoveTo x, y
    Delay 30
    LeftClick 1
    Delay 250	
End Sub

Sub cz2(x,y)	
    MoveTo x, y
    Delay 30
    LeftDoubleClick 1
    Delay 200	
End Sub

Sub ctrlV(str)
    Call Plugin.Sys.SetCLB(str)
    //粘贴
    KeyDown 17, 1
    KeyPress 86, 1
    KeyUp 17, 1
    Delay 200
End Sub
